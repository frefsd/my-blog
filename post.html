<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>æ–‡ç« è¯¦æƒ… - æˆ‘çš„åšå®¢</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    /* å¯é€‰ï¼šå†…è”ä¸€äº›åŸºæœ¬æ ·å¼ï¼Œä¹Ÿå¯ç§»åˆ° style.css */
    #post-container {
      max-width: 1200px;
      margin: 2rem auto;
      padding: 0 1rem;
    }
    .post-content h1, .post-content h2, .post-content h3 {
      color: #333;
      line-height: 1.4;
    }
    .post-content p {
      line-height: 1.8;
      color: #444;
    }
    .category-tag {
      display: inline-block;
      background: #4a6fa5;
      color: white;
      padding: 0.2rem 0.6rem;
      border-radius: 12px;
      font-size: 0.8rem;
      margin-top: 1rem;
    }
    .toc-container {
      flex: 0 0 200px;
      padding-right: 2rem;
      border-right: 1px solid #eee;
      margin-right: 2rem;
    }
    .toc-container ul {
      list-style: none;
      padding: 0;
      font-size: 0.95rem;
    }
    .toc-container a {
      color: #4a6fa5;
      text-decoration: none;
    }
    .toc-container a:hover {
      text-decoration: underline;
    }
    .pagination {
      margin-top: 2rem;
      display: flex;
      justify-content: space-between;
      gap: 1rem;
      flex-wrap: wrap;
    }
    .pagination a, .pagination span {
      color: #4a6fa5;
      text-decoration: underline;
    }
    .pagination span {
      color: #aaa;
      text-decoration: none;
    }
    @media (max-width: 768px) {
      .post-layout {
        flex-direction: column;
      }
      .toc-container {
        flex: none;
        padding-right: 0;
        border-right: none;
        margin-right: 0;
        margin-bottom: 2rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>âœ¨ æˆ‘çš„åšå®¢</h1>
    <nav>
      <a href="index.html">é¦–é¡µ</a>
      <a href="about.html">å…³äº</a>
      <a href="#">è”ç³»</a>
    </nav>
  </header>

  <main id="post-container">
    <p>æ­£åœ¨åŠ è½½æ–‡ç« ...</p>
  </main>

  <footer>
    <p>&copy; 2025 æˆ‘çš„åšå®¢. ç”± JavaScript é©±åŠ¨.</p>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const container = document.getElementById('post-container');

      // ä» URL è·å–æ–‡ç«  ID
      const urlParams = new URLSearchParams(window.location.search);
      const postId = parseInt(urlParams.get('id'));

      if (isNaN(postId)) {
        container.innerHTML = '<p>æ— æ•ˆçš„æ–‡ç«  IDã€‚</p>';
        return;
      }

      fetch('posts.json')
        .then(res => {
          if (!res.ok) throw new Error('æ–‡ç« æ•°æ®åŠ è½½å¤±è´¥');
          return res.json();
        })
        .then(posts => {
          const post = posts[postId];
          if (!post) {
            container.innerHTML = '<p>æ–‡ç« ä¸å­˜åœ¨ã€‚</p>';
            return;
          }

          // è§£æå†…å®¹ï¼Œæå– h2 æ ‡é¢˜ç”¨äºç”Ÿæˆç›®å½•
          const tempDiv = document.createElement('div');
          tempDiv.innerHTML = post.content;

          const headings = Array.from(tempDiv.querySelectorAll('h2'));
          let tocHTML = '';

          if (headings.length > 0) {
            tocHTML = `
              <div class="toc-container">
                <p style="font-weight: bold; margin-bottom: 1rem; color: #333;">ğŸ“Œ ç›®å½•</p>
                <ul>
            `;

            headings.forEach((heading, index) => {
              // ä¸ºæ ‡é¢˜æ·»åŠ å”¯ä¸€ IDï¼ˆç”¨äºé”šç‚¹ï¼‰
              const anchorId = `section-${postId}-${index}`;
              heading.id = anchorId;

              tocHTML += `
                <li style="margin: 0.4rem 0;">
                  <a href="#${anchorId}" 
                     onclick="event.preventDefault(); document.getElementById('${anchorId}').scrollIntoView({ behavior: 'smooth' });">
                    ${heading.textContent}
                  </a>
                </li>
              `;
            });

            tocHTML += `</ul></div>`;
          }

          // é‡æ–°è®¾ç½® contentï¼ˆç°åœ¨åŒ…å« ID çš„æ ‡é¢˜ï¼‰
          const updatedContent = tempDiv.innerHTML;

          // è·å–ä¸Šä¸€ç¯‡/ä¸‹ä¸€ç¯‡
          const prevPost = posts[postId - 1];
          const nextPost = posts[postId + 1];

          const prevLink = prevPost 
            ? `<a href="post.html?id=${postId - 1}">â† ä¸Šä¸€ç¯‡ï¼š${prevPost.title}</a>`
            : `<span>â† æ²¡æœ‰ä¸Šä¸€ç¯‡</span>`;

          const nextLink = nextPost 
            ? `<a href="post.html?id=${postId + 1}">ä¸‹ä¸€ç¯‡ï¼š${nextPost.title} â†’</a>`
            : `<span>æ²¡æœ‰ä¸‹ä¸€ç¯‡ â†’</span>`;

          // æ¸²æŸ“å®Œæ•´é¡µé¢
          container.innerHTML = `
            <article class="post-layout" style="display: flex; gap: 2rem; flex-wrap: wrap;">
              <!-- ç›®å½• -->
              ${tocHTML}

              <!-- æ–‡ç« å†…å®¹ -->
              <div style="flex: 1; min-width: 300px;" class="post-content">
                <h1>${post.title}</h1>
                <p class="date">${post.date}</p>
                <div class="content">
                  ${updatedContent}
                </div>
                ${post.category ? 
                  `<span class="category-tag">${post.category}</span>` : ''}
              </div>
            </article>

            <!-- ä¸Šä¸‹ç¯‡å¯¼èˆª -->
            <div class="pagination">
              <div style="text-align: left;">${prevLink}</div>
              <div style="text-align: right;">${nextLink}</div>
            </div>

            <!-- è¿”å›é¦–é¡µ -->
            <p style="text-align:center; margin-top: 2rem;">
              <a href="index.html">ğŸ  è¿”å›åšå®¢é¦–é¡µ</a>
            </p>
          `;
        })
        .catch(err => {
          container.innerHTML = `<p style="color:red;">åŠ è½½å¤±è´¥: ${err.message}</p>`;
        });
    });
  </script>
</body>
</html>